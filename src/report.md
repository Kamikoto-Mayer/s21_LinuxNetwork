# Сети в Linux

## Part 1. Инструмент **ipcalc**

#### 1.1. Сети и маски
##### 1)![Иллюстрация к проекту](./img/Part%201/1.1.1.png)

##### 2)
![Иллюстрация к проекту](./img/Part%201/1.1.2.1.png)
- Узнал обычную и двоичную запись маски /15 с помощью ipcalc

![Иллюстрация к проекту](./img/Part%201/1.1.2.2.png)
- Узнал префиксную и двоичную запись маски 255.255.255.0 с помощью ipcalc

*11111111.11111111.11111111.11110000* = 255.255.255.240 || /28

##### 3)
![Иллюстрация к проекту](./img/Part%201/1.1.3.1.png)
- Минимальный и максимальный хост в сети *12.167.38.4* при маскe: */8*

![Иллюстрация к проекту](./img/Part%201/1.1.3.2.png)
- Минимальный и максимальный хост в сети *12.167.38.4* при маскe: *11111111.11111111.00000000.00000000*

![Иллюстрация к проекту](./img/Part%201/1.1.3.3.png)
- Минимальный и максимальный хост в сети *12.167.38.4* при маскe: *255.255.254.0*

![Иллюстрация к проекту](./img/Part%201/1.1.3.4.png)
- Минимальный и максимальный хост в сети *12.167.38.4* при маскe: */4*

#### 1.2. localhost

##### 1. IP-адрес 194.34.23.100

- **Анализ**: 194.34.23.100 не принадлежит диапазону 127.0.0.0/8.
- **Вывод**: Нет, этот IP-адрес не может использоваться для доступа к localhost.

##### 2. IP-адрес 127.0.0.2

- **Анализ**: 127.0.0.2 принадлежит диапазону 127.0.0.0/8.
- **Вывод**: Да, этот IP-адрес может использоваться для доступа к localhost.

##### 3. IP-адрес 127.1.0.1

- **Анализ**: 127.1.0.1 принадлежит диапазону 127.0.0.0/8.
- **Вывод**: Да, этот IP-адрес может использоваться для доступа к localhost.

##### 4. IP-адрес 128.0.0.1

- **Анализ**: 128.0.0.1 не принадлежит диапазону 127.0.0.0/8.
- **Вывод**: Нет, этот IP-адрес не может использоваться для доступа к localhost.

#### 1.3. Диапазоны и сегменты сетей

##### 1. Публичные и частные IP

- **10.0.0.45**: Частный (диапазон 10.0.0.0 – 10.255.255.255)
- **134.43.0.2**: Публичный
- **192.168.4.2**: Частный (диапазон 192.168.0.0 – 192.168.255.255)
- **172.20.250.4**: Частный (диапазон 172.16.0.0 – 172.31.255.255)
- **172.0.2.1**: Публичный
- **192.172.0.1**: Публичный
- **172.68.0.2**: Публичный
- **172.16.255.255**: Частный (диапазон 172.16.0.0 – 172.31.255.255)
- **10.10.10.10**: Частный (диапазон 10.0.0.0 – 10.255.255.255)
- **192.169.168.1**: Публичный

##### 2. Возможные адреса шлюза для сети 10.10.0.0/18

Диапазон сети 10.10.0.0/18:

- **Адрес сети**: 10.10.0.0
- **Последний адрес сети**: 10.10.63.255

Следовательно, возможные IP-адреса шлюза:

- **10.0.0.1**: Нет
- **10.10.0.2**: Да
- **10.10.10.10**: Да
- **10.10.100.1**: Нет
- **10.10.1.255**: Да

## Part 2. Статическая маршрутизация между двумя машинами

![Иллюстрация к проекту](./img/Part%202/ws1/ws1%201.png)
- С помощью команды `ip a` посмотрел существующие сетевые интерфейсы.(ws1)

![Иллюстрация к проекту](./img/Part%202/ws2/ws2%201.png)
- С помощью команды `ip a` посмотрел существующие сетевые интерфейсы.(ws2)

![Иллюстрация к проекту](./img/Part%202/ws1/ws1%202.1.1.png)
- Задал ip-адрес для вм ws1
![Иллюстрация к проекту](./img/Part%202/ws2/ws2%202.1.1.png)
- Задал ip-адрес для вм ws2

#### 2.1. Добавление статического маршрута вручную

![Иллюстрация к проекту](./img/Part%202/ws1/ws1%202.1.2.png)
- Задал статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r(route) add` для ws1. Там же я сразу пропинговал другую машинину

![Иллюстрация к проекту](./img/Part%202/ws2/ws2%202.1.2.png)
- Задал статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r(route) add` для ws1. Там же я сразу пропинговал другую машинину

#### 2.2. Добавление статического маршрута с сохранением

![Иллюстрация к проекту](./img/Part%202/ws1/ws1%20p2%202.2.png)
- Добавил статический маршрут для ws1 от одной машины до другой с помощью файла *etc/netplan/00-installer-config.yaml*.

![Иллюстрация к проекту](./img/Part%202/ws2/ws2%20p2%202.2.png)
- Добавил статический маршрут для ws1 от одной машины до другой с помощью файла *etc/netplan/00-installer-config.yaml*.

![Иллюстрация к проекту](./img/Part%202/ws1/ws1%20p2%203.png)
- Пропинговал соединение между машинами.

![Иллюстрация к проекту](./img/Part%202/ws2/ws2%20p2%204.png)
- Пропинговал соединение между машинами.

## Part 3. Утилита **iperf3**

### 3.1. Скорость соединения:

#### 8 Mbps в MB/s:

- 1 Мегабит в секунду (Mbps) = 0.125 Мегабайта в секунду (MB/s)
- Таким образом, 8 Mbps = 8 * 0.125 = 1 MB/s.

#### 100 MB/s в Kbps:

- 1 Мегабайт в секунду (MB/s) = 8 Мегабит в секунду (Mbps)
- Таким образом, 100 MB/s = 100 * 8 = 800 Mbps.

#### 1 Gbps в Mbps:

- 1 Гигабит в секунду (Gbps) = 1000 Мегабит в секунду (Mbps).

#### 3.2. Утилита **iperf3**

![Иллюстрация к проекту](./img/Part%203/ws1/1.png)
- Использовал команду ```iperf3 -s``` что бы включить режим сервера и просто принимать пакеты

![Иллюстрация к проекту](./img/Part%203/ws2/1.png)
- Использовал команду ```iperf3 -с 192.168.100.10``` что бы отправлять пакеты на другую вм после чего я и узнал скорость соеденения

## Part 4. Сетевой экран

### 4.1. Утилита **iptables**

![Иллюстрация к проекту](./img/Part%204/ws1/2.png)
Настроил файл sh со всеми правилами(ws1)

![Иллюстрация к проекту](./img/Part%204/ws2/2.png)
- Настроил файл sh со всеми правилами(ws2)

#### Разница между стратегиями:

##### ws1:
В начале устанавливается правило по умолчанию для запрета всех входящих пакетов (DROP). Далее явно разрешаются пакеты для SSH (порт 22) и HTTP (порт 80). Запреты и разрешения для echo reply добавляются после этих правил.

##### ws2:
В начале устанавливается правило по умолчанию для разрешения всех входящих пакетов (ACCEPT). Далее явно разрешаются пакеты для SSH (порт 22) и HTTP (порт 80). Запреты и разрешения для echo reply добавляются после этих правил.

### 4.2. Утилита **nmap**
![Иллюстрация к проекту](./img/Part%204/ws1.png)
ws1
![Иллюстрация к проекту](./img/Part%204/ws2.png)
ws2

```bash
vboxmanage export ws1 --output ws1.ova
vboxmanage export ws2 --output ws2.ova
```
С помощью этих команд я создал дампы образов виртуальных машин

## Part 5. Статическая маршрутизация сети

### 5.1. Настройка адресов машин

![Иллюстрация к проекту](./img/Part%205/5.1/r_1/r1%201.png)
- Настроил конфигурацию машины r1 в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.

![Иллюстрация к проекту](./img/Part%205/5.1/ws_11/ws11%201.png)
- Настроил конфигурацию машины ws11 в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.

![Иллюстрация к проекту](./img/Part%205/5.1/r_2/r2%201.png)
- Настроил конфигурацию машины r2 в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.

![Иллюстрация к проекту](./img/Part%205/5.1/ws_21/ws21%201.png)
- Настроил конфигурацию машины ws21 в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.

![Иллюстрация к проекту](./img/Part%205/5.1/ws_22/ws22%201.png)
- Настроил конфигурацию машины ws22 в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.

![Иллюстрация к проекту](./img/Part%205/5.1/r_1/r1%202.png)
- Использовал команду `ip -4 a` что бы проверить сетевые интерфейсы на вм r1

![Иллюстрация к проекту](./img/Part%205/5.1/ws_11/ws11%202.png)
- Использовал команду `ip -4 a` что бы проверить сетевые интерфейсы на вм ws11

![Иллюстрация к проекту](./img/Part%205/5.1/r_2/r2%202.png)
- Использовал команду `ip -4 a` что бы проверить сетевые интерфейсы на вм r2

![Иллюстрация к проекту](./img/Part%205/5.1/ws_21/ws21%202.png)
- Использовал команду `ip -4 a` что бы проверить сетевые интерфейсы на вм ws21

![Иллюстрация к проекту](./img/Part%205/5.1/ws_22/ws22%202.png)
- Использовал команду `ip -4 a` что бы проверить сетевые интерфейсы на вм ws22

![Иллюстрация к проекту](./img/Part%205/5.1/r_1/r1%203.png)
- Пропинговал ВМ r1 -> ws11

![Иллюстрация к проекту](./img/Part%205/5.1/ws_11/ws11%203.png)
- Пропинговал ВМ ws11 -> r1

![Иллюстрация к проекту](./img/Part%205/5.1/r_2/r2%203.png)
- Пропинговал ВМ r2 -> ws21

![Иллюстрация к проекту](./img/Part%205/5.1/r_2/r2%204.png)
- Пропинговал ВМ r2 -> ws22

![Иллюстрация к проекту](./img/Part%205/5.1/ws_11/ws11%203.png)
- Пропинговал ВМ ws11 -> r1

![Иллюстрация к проекту](./img/Part%205/5.1/ws_22/ws22%203.png)
- Пропинговал ВМ ws22 -> r1

![Иллюстрация к проекту](./img/Part%205/5.1/ws_22/ws22%204.png)
- Пропинговал ВМ ws22 -> ws21

![Иллюстрация к проекту](./img/Part%205/5.1/ws_21/ws21%204.png)
- Пропинговал ВМ ws21 -> ws22

### 5.2. Включение переадресации IP-адресов

![Иллюстрация к проекту](./img/Part%205/5.2/r_1/1.png)
Включил переадресацию IP, выполнил команду на роутере r1:
`sysctl -w net.ipv4.ip_forward=1`

![Иллюстрация к проекту](./img/Part%205/5.2/r_2/1.png)
Включил переадресацию IP, выполнил команду на роутере r2:
`sysctl -w net.ipv4.ip_forward=1`

![Иллюстрация к проекту](./img/Part%205/5.2/r_1/2.png)
Включил переадресацию IP, добавил команду в файл */etc/sysctl.conf* на роутере r1:
`net.ipv4.ip_forward = 1`

![Иллюстрация к проекту](./img/Part%205/5.2/r_2/2.png)
Включил переадресацию IP, добавил команду в файл */etc/sysctl.conf* на роутере r2:
`net.ipv4.ip_forward = 1`

### 5.3. Установка маршрута по-умолчанию

Маршрут по умолчанию я добавил для всех машин еще в первом задании `5.1`

![Иллюстрация к проекту](./img/Part%205/5.3/ws_11/1.png)
Вызвал команду `ip r` где показал что маршрут добавлен

![Иллюстрация к проекту](./img/Part%205/5.3/ws_21/1.png)
Вызвал команду `ip r` где показал что маршрут добавлен

![Иллюстрация к проекту](./img/Part%205/5.3/ws_22/1.png)
Вызвал команду `ip r` где показал что маршрут добавлен

![Иллюстрация к проекту](./img/Part%205/5.3/ws_11/2.png)
Пропинговал r2 из ws11

![Иллюстрация к проекту](./img/Part%205/5.3/r_2/1.png)
Показал с помощью команды `tcpdump -tn -i enp0s2` что пинг доходит

### 5.4. Добавление статических маршрутов

![Иллюстрация к проекту](./img/Part%205/5.4/r_1/1.png)
Добавил в роутер r1 статический маршрут в файле конфигураций.

![Иллюстрация к проекту](./img/Part%205/5.4/r_2/1.png)
Добавил в роутер r2 статический маршрут в файле конфигураций.

![Иллюстрация к проекту](./img/Part%205/5.4/r_1/2.png)
Вызвал `ip r` и показал таблицу с маршрутами для r1

![Иллюстрация к проекту](./img/Part%205/5.4/r_2/2.png)
Вызвал `ip r` и показал таблицу с маршрутами для r2

![Иллюстрация к проекту](./img/Part%205/5.4/ws_11/1.png)
![Иллюстрация к проекту](./img/Part%205/5.4/ws_11/2.png)
```
Маршрут для 10.10.0.0/18
Маршрут 10.10.0.0/18 указывает, что все пакеты, направленные на адреса в сети 10.10.0.0/18, будут отправлены через интерфейс enp0s2. Это происходит потому, что этот маршрут более специфичен (сеть /18), чем маршрут по умолчанию.

Маршрут для 0.0.0.0/0
Маршрут 0.0.0.0/0 (маршрут по умолчанию) указывает, что все остальные пакеты, которые не соответствуют другим более специфичным маршрутам, будут отправлены через шлюз 10.10.0.1 на интерфейсе enp0s2.
```

### 5.5. Построение списка маршрутизаторов

![Иллюстрация к проекту](./img/Part%205/5.5/ws_11/1.png)
Использовал **traceroute** на ws11 -> ws21
![Иллюстрация к проекту](./img/Part%205/5.5/r_1/1.png)
Запустил на r1 команду дампа `tcpdump -tnv -i eth0`
```
Утилита traceroute работает, отправляя пакеты с постепенно увеличивающимся значением поля TTL (Time To Live) в заголовке IP. Поле TTL указывает, сколько маршрутизаторов (или "хопов") может пройти пакет до его истечения. Каждый маршрутизатор на пути уменьшает TTL на единицу. Когда TTL достигает нуля, маршрутизатор отклоняет пакет и отправляет обратно ICMP сообщение "Time Exceeded".

Процесс выглядит следующим образом:

Первый хоп:

traceroute отправляет пакет с TTL = 1.
Первый маршрутизатор на пути (r1) уменьшает TTL на 1, TTL становится 0.
Маршрутизатор r1 отправляет обратно сообщение "Time Exceeded".
Второй хоп:

traceroute отправляет пакет с TTL = 2.
Первый маршрутизатор (r1) уменьшает TTL на 1, TTL становится 1, и пересылает пакет на следующий маршрутизатор (r2).
Второй маршрутизатор (r2) уменьшает TTL на 1, TTL становится 0.
Маршрутизатор r2 отправляет обратно сообщение "Time Exceeded".
Третий хоп:

traceroute отправляет пакет с TTL = 3.
Пакет проходит через r1, TTL уменьшается до 2.
Пакет проходит через r2, TTL уменьшается до 1.
Пакет достигает ws21, TTL уменьшается до 0.
ws21 отправляет обратно сообщение "Time Exceeded".
Этот процесс продолжается до тех пор, пока пакет не достигнет конечного пункта назначения (ws21).
```

### 5.6. Использование протокола **ICMP** при маршрутизации

![Иллюстрация к проекту](./img/Part%205/5.6/r_1/1.png)
Запустил на r1 перехват сетевого трафика, проходящего через enp0s2 с помощью команды:
`tcpdump -n -i eth0 icmp`

![Иллюстрация к проекту](./img/Part%205/5.6/ws_11/1.png)
Пропинговал с ws11 несуществующий IP (например, *10.30.0.111*) с помощью команды:
`ping -c 1 10.30.0.111`


## Part 6. Динамическая настройка IP с помощью **DHCP**

![Иллюстрация к проекту](./img/Part%206/6.1/r_2/1.png)
Для r2 настроил в файле */etc/dhcp/dhcpd.conf* конфигурацию службы **DHCP**

![Иллюстрация к проекту](./img/Part%206/6.1/r_2/2.png)
В файле *resolv.conf* прописал `nameserver 8.8.8.8`

Перезагрузил службу dhcp и машину ws21

![Иллюстрация к проекту](./img/Part%206/6.1/ws_21/1.png)
Использовал команду `ip a` и получл ip адрес

![Иллюстрация к проекту](./img/Part%206/6.1/ws_21/2.png)
Показал что машины пингуются

![Иллюстрация к проекту](./img/Part%206/6.2/r_1/1.png)
Настроил r1 для раздачи dhcp с привязкой к mac-адресу

![Иллюстрация к проекту](./img/Part%206/6.2/ws_11/1.png)
Поменял настройки netplan в ws11

![Иллюстрация к проекту](./img/Part%206/6.2/ws_11/2.png)
Показал что я получил ip адрес из роутера

![Иллюстрация к проекту](./img/Part%206/6.2/ws_11/Снимок%20экрана%202024-06-14%20в%2014.59.54.png)
Здесь я показал нынешний ip-адрес и обновил его

## Part 7. **NAT**

![Иллюстрация к проекту](./img/Part%207/7.1/r_1/1.png)
В файле */etc/apache2/ports.conf* r1 изменил строку `Listen 80` на `Listen 0.0.0.0:80`

![Иллюстрация к проекту](./img/Part%207/7.1/ws_22/1.png)
В файле */etc/apache2/ports.conf* ws22 изменил строку `Listen 80` на `Listen 0.0.0.0:80`

![Иллюстрация к проекту](./img/Part%207/7.1/r_1/2.png)
![Иллюстрация к проекту](./img/Part%207/7.1/ws_22/2.png)
Запустил веб-сервер Apache командой `service apache2 start` на ws22 и r1.

![Иллюстрация к проекту](./img/Part%207/7.1/r_2/1.png)
Добавил в фаервол на r2

![Иллюстрация к проекту](./img/Part%207/7.1/ws_22/3.png)
После добавление конфигурации фаервола не пингуются машины

![Иллюстрация к проекту](./img/Part%207/7.1/r_2/2.png)
Добавил новые конфигурации в фаервол

![Иллюстрация к проекту](./img/Part%207/7.1/ws_22/4.png)
После добавление новой конфигурации фаервола пингуются машины

Выше я прикрепил уже полный фаервол с **SNAT** и **DNAT**

![Иллюстрация к проекту](./img/Part%207/7.1/ws_22/5.png)
Подключился к серверу ws22 -> r1  командой: `telnet [адрес] [порт]`

![Иллюстрация к проекту](./img/Part%207/7.1/r_1/3.png)
Подключился к серверу r1 -> ws22  командой: `telnet [адрес] [порт]`

## Part 8. Дополнительно. Знакомство с **SSH Tunnels**